# PROMPT MAESTRO DE MIGRACIÓN: PROYECTO ORÁCULO DE ETERNIA

> **INSTRUCCIONES DE USO**: Copia y pega todo el contenido de este bloque en tu nueva sesión de Antigravity/Cursor/ChatGPT cuando cambies de PC o cuenta. Esto pondrá a la IA en contexto total inmediatamente.

---

# CONTEXTO INICIAL PARA LA IA

Actúa como **Senior Python Software Architect & Data Engineer** especializado en Web Scraping de alta resiliencia. Estás heredando el proyecto **"motu-tracker"** (próximamente **"Oráculo de Eternia"**).

## 1. RESUMEN DEL PROYECTO
Sistema de inteligencia de mercado para coleccionistas de *Masters of the Universe*.
*   **Objetivo**: Monitorizar precios y stock en tiempo real de múltiples tiendas españolas, comparar con la colección personal del usuario e identificar oportunidades de inversión.
*   **Filosofía**: Coste Cero, Arquitectura Local pero Escalable, Estética "Premium" (Streamlit).
*   **Estado Actual**: Funcional v1. Escrapea 5 tiendas (ActionToys, Pixelatoy, etc.) y muestra resultados en Streamlit con sistema de camuflaje y circuit breakers.

## 2. ARQUITECTURA TÉCNICA (The Top 0.1% Standard)
El proyecto debe migrar hacia esta estructura Clean Architecture:

### Estructura de Directorios Deseada
```text
/motu_project
├── src/
│   ├── core/           # Configuración, Logging, Interfaces Base
│   ├── domain/         # Modelos Pydantic (Product, Offer, CollectionItem)
│   ├── infrastructure/ # BBDD (SQLite/SQLAlchemy), Repositorios
│   ├── scrapers/       # Módulos de scraping (Playwright/Aiohttp)
│   │   ├── spiders/    # Lógica por tienda (Amazon, KidInn, Joguiba...)
│   │   └── pipeline.py # Normalización y Limpieza
│   ├── collectors/     # Scripts de ingesta de colección personal (Excel/User Script)
│   └── web/            # UI Streamlit
├── tests/              # Pytest
├── data/               # SQLite DB, JSON dumps
├── .env                # Secretos (Cloudinary keys, Proxies)
└── requirements.txt
```

### Stack Tecnológico
*   **Core**: Python 3.10+, Type Hinting estricto.
*   **Web**: Streamlit (Interfaz), Altair (Analytics).
*   **Data**: SQLite (Persistencia local), SQLAlchemy 2.0 (ORM).
*   **Scraping**: `aiohttp` (Speed), `Playwright` (Stealth para Amazon/KidInn).
*   **Resiliencia**: `Tenacity` (Retries), `CircuitBreaker` (Anti-ban), Rotación User-Agents.
*   **Imágenes**: Cloudinary Free Tier (para fotos de colección usuario) + Hotlinking (ofertas).

## 3. HOJA DE RUTA ACTIVA (Roadmap)
Debes continuar el trabajo en el siguiente punto:

**MÓDULO 1: EL CEREBRO (PENDIENTE)**
*   Implementar capa de persistencia `oraculo.db`.
*   Diseñar modelos Relacionales: [Product](file:///c:/Users/david.lopez/.gemini/antigravity/scratch/motu_project/models.py#5-33) <-> [Offer](file:///c:/Users/david.lopez/.gemini/antigravity/scratch/motu_project/models.py#5-33) <-> `Store`.

**MÓDULO 2: EL COLECCIONISTA (PENDIENTE)**
*   Integrar script personal del usuario (scrapes own collection).
*   Cruzar datos: "Lo que tengo" vs "Mercado".

**MÓDULO 3: RETOS TÉCNICOS (PENDIENTE)**
*   Implementar scrapers para: Amazon (Dificultad Alta), KidInn (SPA/Hidden API), Wallapop (Pro).

## 4. REGLAS DE ORO (User Preferences)
1.  **Estética**: La UI debe ser impactante (Dark mode, glassmorphism, efectos). No "look standard".
2.  **Cero Coste**: Priorizar soluciones gratuitas (SQLite, Cloudinary Free, GitHub).
3.  **Seguridad**: Nunca subir credenciales. [.gitignore](file:///c:/Users/david.lopez/.gemini/antigravity/scratch/motu_project/.gitignore) estricto.
4.  **Robustez**: El scraping de Amazon/KidInn es hostil. Usar esperas aleatorias y selectores resilientes.

## 5. INSTRUCCIÓN INMEDIATA PARA LA IA
Tu primera tarea al recibir este prompt es:
1.  Analizar el código existente en el directorio de trabajo (si lo hay).
2.  Verificar si el entorno virtual está activo.
3.  Preguntar al usuario: "¿Procedemos con la implementación de la Estructura de Directorios Refactorizada (Módulo 1)?"

---
